<%- include('partials/header') %>

<h2>Today's Menu</h2>

<%- include('partials/header') %>

<h2>Today's Menu</h2>

<!-- 新增：搜索表单（加分项！） -->
<div class="search-box">
  <form action="/" method="GET">
    <input type="text" name="name" placeholder="Dish name contains..." value="<%= query.name || '' %>">
    
    <select name="category">
      <option value="">All Categories</option>
      <option value="Main" <%= query.category==='Main' ? 'selected' : '' %>>Main</option>
      <option value="Stir-fry" <%= query.category==='Stir-fry' ? 'selected' : '' %>>Stir-fry</option>
      <option value="Noodles" <%= query.category==='Noodles' ? 'selected' : '' %>>Noodles</option>
      <option value="Soup" <%= query.category==='Soup' ? 'selected' : '' %>>Soup</option>
      <option value="Drink" <%= query.category==='Drink' ? 'selected' : '' %>>Drink</option>
    </select>

    <input type="number" name="maxPrice" placeholder="Max price (any tier)" value="<%= query.maxPrice || '' %>" step="1">

    <label>
      <input type="checkbox" name="spicy" <%= query.spicy ? 'checked' : '' %>> Only Spicy
    </label>

    <button type="submit">Search</button>
    <a href="/" class="btn-clear">Clear</a>
  </form>
</div>

<!-- 显示搜索结果数量 -->
<% if (query && Object.keys(query).length > 0) { %>
  <p><strong><%= dishes.length %> dish(es) found</strong></p>
<% } %>

<table class="menu-table">
  <thead>
    <tr>
      <th>Dish Name</th>
      <th>Category</th>
      <th>Description</th>
      <th>Student Price</th>
      <th>Staff Price</th>
      <th>Visitor Price</th>
      <% if (isAdmin) { %>
        <th>Actions</th>
      <% } %>
    </tr>
  </thead>
  <tbody>
    <% dishes.forEach(dish => { %>
      <tr <%= dish.spicy ? 'class="spicy"' : '' %>>
        <td><strong><%= dish.name %></strong> <%= dish.spicy ? '(Spicy)' : '' %></td>
        <td><%= dish.category %></td>
        <td><%= dish.description || '-' %></td>
        <td>¥<%= dish.price.student %></td>
        <td>¥<%= dish.price.staff %></td>
        <td>¥<%= dish.price.visitor %></td>
        <% if (isAdmin) { %>
          <td>
            <a href="/edit/<%= dish._id %>" class="btn-edit">Edit</a>
            <form action="/delete/<%= dish._id %>" method="POST" style="display:inline;">
              <button type="submit" class="btn-delete" onclick="return confirm('Delete <%= dish.name %>?')">Delete</button>
            </form>
          </td>
        <% } %>
      </tr>
    <% }) %>
  </tbody>
</table>

<h3>RESTful API Test</h3>
<pre>GET    <a href="/api/dishes" target="_blank">/api/dishes</a></pre>
<pre>POST   /api/dishes        (Admin only)</pre>
<pre>PUT    /api/dishes/:id    (Admin only)</pre>
<pre>DELETE /api/dishes/:id    (Admin only)</pre>

<%- include('partials/footer') %>